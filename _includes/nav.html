<nav id="nav" class="layout--menu nav--hide">
  <div class="menu">
    <ul class="menu--list">
      <a class="menu--list--logo" href="{{ site.baseurl }}/" rel="home">
        <svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 319 142">
          <path fill-rule="evenodd" d="
        M 218.557515799999,41.3397837877274
        C 256.088294327259,33.1255403757095 280.674973607063,13.0947418212891 282.274326264858,4.46646332740784
        C 282.539779067039,3.40546774864197 282.805326938629,2.34415054321289 283.07077974081,1.28315496444702
        C 283.07077974081,19.457617521286 292.132814764977,47.1758519411087 317.584055244923,47.1758519411087
        C 317.584055244923,47.7947632074356 312.999998509884,50.381081700325 312.999998509884,50.9999929666519
        C 310.594932615757,50.9999929666519 306.949439108372,54.3534333705902 293.159279167652,55.3993971347809
        C 241.38368076086,56.460502743721 243.334390938282,84.1846364736557 226.78759843111,108.985090732574
        C 221.124446868896,119.418228030205 215.459603071213,129.854488492012 209.796451508999,140.287625789642
        C 209.796451508999,128.509801268578 211.097419321537,102.326758623123 202.893804013729,94.1296545267105
        C 180.344500184059,94.1296545267105 147.25559258461,102.239276170731 129.619456768036,119.861395716667
        C 120.239870905876,126.404213070869 110.857451975346,132.94898557663 101.477866113186,139.491802930832
        C 101.477866113186,128.228614926338 123.99999910593,100.318530201912 123.99999910593,77.9999927282333
        C 118.895494401455,71.8986587524414 112.724824309349,68.5699328184128 105.46017152071,67.6020820140839
        C 39.092768907547,58.7601333856583 10.420481801033,96.0391689538956 1.99999415874481,115.999996781349
        C 2.44242817163467,116.353659152985 10.5575528740883,115.646334409714 10.9999868869781,115.999996781349
        C 52.3141285777092,115.999996781349 87.2374764680862,94.0817490816116 123.778753578663,75.825627207756
        C 137.811207413673,68.8149700164795 153.09852039814,80.9612348079681 195.999997973442,52.9999945163727
        C 196.667328178883,53.6668027639389 202.05536788702,47.1041799783707 218.557515799999,41.3397837877274
        Z
      " />
        </svg>
      </a>
      <div class="menu-separator"></div>

      {% for category in site.categories %}
      {% if category[0] == "Разработка" %}
      <li class="menu--list--link is--selected" id={{ 'menu--list--link--' | append: category[0] }}>
        {% else  %}
      <li class="menu--list--link" id={{ 'menu--list--link--' | append: category[0] }}>
        {% endif  %}
        <a href="#" onclick="changeCategory(`{{ category[0] }}`)">{{ category[0] }}</a>
      </li>
      {% endfor %}
    </ul>
  </div>



  {% for category in site.categories %}
  {% assign posts = site.posts | where_exp:"item",
      "item.categories contains category[0]" %}
  {% if category[0] == "Разработка" %}
  <div class="sub-menu sub-menu--display" id={{ 'sub-menu--' | append: category[0] }}>
    {% else  %}
    <div class="sub-menu" id={{ 'sub-menu--' | append: category[0] }}>
      {% endif  %}
      <ul class="sub-menu--list">

        {% assign groupPosts = posts | group_by: "tag" %}
          {% for group in groupPosts %}
          <span class="sub-menu--list--header">{{group.name}}</span>
          {% for post in group.items %}
          <li class="sub-menu--list--link">
            <a href="{{ post.url | prepend:site.baseurl }}">{{ post.title }}</a>
          </li>
          {% endfor %}
        {% endfor %}

      </ul>
    </div>
    {% endfor %}

</nav>


<script>
  let defaultOpenCategory, defaultSelectedMenu;
  const SUB_CSS = `sub-menu--`;
  const LINK_CSS = `menu--list--link--`;
  let categoryFromLocalstore = localStorage.getItem('category');

  const hideDOM = (elem, action = true) => {
    const domElement = document.getElementById(elem);
    const cssClass = 'sub-menu--display';
    action ? domElement.classList.remove(cssClass) :
      domElement.classList.add(cssClass);
  };
  const unselectDOM = (elem, action = true) => {
    const domElement = document.getElementById(elem);
    const cssClass = 'is--selected';
    action ? domElement.classList.remove(cssClass) :
      domElement.classList.add(cssClass);
  };

  defaultOpenCategory = `${SUB_CSS}Разработка`;
  defaultSelectedMenu = `${LINK_CSS}Разработка`;

  const changeCategory = category => {
    localStorage.setItem('category', category);
    const idShowElem = `${SUB_CSS}${category}`;
    const idSelectedElem = `${LINK_CSS}${category}`;
    if (defaultOpenCategory === idShowElem) return;

    hideDOM(idShowElem, false);
    unselectDOM(idSelectedElem, false);

    hideDOM(defaultOpenCategory);
    unselectDOM(defaultSelectedMenu)

    defaultOpenCategory = idShowElem;
    defaultSelectedMenu = idSelectedElem;
  };

  /* Если в localstore есть категория, то сделать ее активной */
  if (categoryFromLocalstore) {
    changeCategory(categoryFromLocalstore);
  }

</script>